{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning",
      "Microsoft.Hosting.Lifetime": "Information"
    }
  },
  "AllowedHosts": "*",
  "Sql": {
    "ConnectionString": "Data Source=127.0.0.1;Initial Catalog=OpenLDRReporting; User Id=sa; Password=disalab;MultipleActiveResultSets=True"
  },
  "Api": {
    "Version": 1,
    "Key": "e98389ca62d99875ba7a4e0f2929960b",
    "ReturnTypes": [ "json", "xml" ],
    "Queries": [
      {
        "Key": "globalhealth_GetOrganisms",
        "Query": [
          "SELECT DISTINCT [ORGANISM]",
          "FROM [OpenLDRData].[dbo].[Monitoring]",
          "WHERE [ORGANISM] <> ''",
          "ORDER BY [ORGANISM]"
        ]
      },
      {
        "Key": "globalhealth_GetDrugs",
        "Query": [
          "SELECT DISTINCT CAST(LEFT([ResistantDrugs], CHARINDEX('~',[ResistantDrugs]+'~')-1) AS VARCHAR(250)) AS Drug",
          "FROM [OpenLDRData].[dbo].[Monitoring]",
          "WHERE [ResistantDrugs] > ''",
          "ORDER BY [Drug]"
        ]
      },
      {
        "Key": "globalhealth_GetSusceptability",
        "Query": [
          "WITH Resistant(RequestID, OBRSetID, OBXSetID, OBXSubID, ORGANISM, Drug, ResistantDrugs, IsRow, Date, Month, Year) AS ( ",
          " SELECT  ",
          "  A.RequestID ",
          "  , A.OBRSetID ",
          "  , OBXSetID ",
          "  , OBXSubID ",
          "  , ORGANISM ",
          "  , CAST(LEFT(ResistantDrugs, CHARINDEX('~',ResistantDrugs+'~')-1) AS VARCHAR(250)) ",
          "  , CAST(STUFF(ResistantDrugs, 1, CHARINDEX('~',ResistantDrugs+'~'), '') AS VARCHAR(250)) ",
          "  , 1  ",

          "   ,(CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(day,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(day,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(day,[AuthorisedDateTime])",
          "         ELSE 0 END) as \"Date\"",
          "   ,(CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(month,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(month,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(month,[AuthorisedDateTime])",
          "         ELSE 0 END) as \"Month\"",
          "   ,(CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(year,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(year,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(year,[AuthorisedDateTime])",
          "         ELSE 0 END) as \"Year\"",

          " FROM [OpenLDRData].[dbo].[Monitoring] A ",
          " JOIN [OpenLDRData].[dbo].[Requests] B ",
          " ON A.RequestID = B.RequestID  ",
          " AND A.OBRSetID = B.OBRSetID ",
          " WHERE SurveillanceCode LIKE '{2}' ",
          "AND",
          " (",
          "  ([RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}') OR",
          "  ([AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}') OR",
          "  ([AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}')",
          "  )",
          " AND (CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(day,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(day,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(day,[AuthorisedDateTime])",
          "         ELSE 0 END) <> 0",
          " AND (CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(month,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(month,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(month,[AuthorisedDateTime])",
          "         ELSE 0 END) <> 0",
          " AND (CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(year,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(year,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(year,[AuthorisedDateTime])",
          "         ELSE 0 END) <> 0 ",
          " UNION ALL ",
          " SELECT  ",
          "    RequestID ",
          "  , OBRSetID ",
          "  , OBXSetID ",
          "  , OBXSubID ",
          "  , ORGANISM ",
          "  , CAST(LEFT(ResistantDrugs, CHARINDEX('~',ResistantDrugs+'~')-1) AS VARCHAR(250)) ",
          "  , CAST(STUFF(ResistantDrugs, 1, CHARINDEX('~',ResistantDrugs+'~'), '') AS VARCHAR(250)) ",
          "  , 0 ",
          "  , Date ",
          "  , Month ",
          "  , Year ",
          " FROM [Resistant] ",
          " WHERE ResistantDrugs > '' ",
          "), ",
          "[Intermediate](RequestID, OBRSetID, OBXSetID, OBXSubID, ORGANISM, Drug, IntermediateDrugs, IsRow, Date, Month, Year) AS ( ",
          " SELECT  ",
          "    A.RequestID ",
          "  , A.OBRSetID ",
          "  , OBXSetID ",
          "  , OBXSubID ",
          "  , ORGANISM ",
          "  , CAST(LEFT(IntermediateDrugs, CHARINDEX('~',IntermediateDrugs+'~')-1) AS VARCHAR(250)) ",
          "  , CAST(STUFF(IntermediateDrugs, 1, CHARINDEX('~',IntermediateDrugs+'~'), '') AS VARCHAR(250)) ",
          "  , 1 ",

          "   ,(CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(day,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(day,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(day,[AuthorisedDateTime])",
          "         ELSE 0 END) as \"Date\"",
          "   ,(CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(month,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(month,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(month,[AuthorisedDateTime])",
          "         ELSE 0 END) as \"Month\"",
          "   ,(CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(year,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(year,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(year,[AuthorisedDateTime])",
          "         ELSE 0 END) as \"Year\"",

          " FROM [OpenLDRData].[dbo].[Monitoring] A ",
          " JOIN [OpenLDRData].[dbo].[Requests] B ",
          " ON A.RequestID = B.RequestID  ",
          " AND A.OBRSetID = B.OBRSetID ",
          " WHERE SurveillanceCode LIKE '{2}' ",
          "AND",
          " (",
          "  ([RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}') OR",
          "  ([AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}') OR",
          "  ([AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}')",
          "  )",
          " AND (CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(day,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(day,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(day,[AuthorisedDateTime])",
          "         ELSE 0 END) <> 0",
          " AND (CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(month,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(month,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(month,[AuthorisedDateTime])",
          "         ELSE 0 END) <> 0",
          " AND (CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(year,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(year,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(year,[AuthorisedDateTime])",
          "         ELSE 0 END) <> 0 ",
          " UNION ALL ",
          " SELECT  ",
          "  RequestID ",
          "  , OBRSetID ",
          "  , OBXSetID ",
          "  , OBXSubID ",
          "  , ORGANISM ",
          "  , CAST(LEFT(IntermediateDrugs, CHARINDEX('~',IntermediateDrugs+'~')-1) AS VARCHAR(250)) ",
          "  , CAST(STUFF(IntermediateDrugs, 1, CHARINDEX('~',IntermediateDrugs+'~'), '') AS VARCHAR(250)) ",
          "  , 0 ",
          "  , Date ",
          "  , Month ",
          "  , Year ",
          " FROM [Intermediate] ",
          " WHERE IntermediateDrugs > '' ",
          "), ",
          "[Sensitive](RequestID, OBRSetID, OBXSetID, OBXSubID, ORGANISM, Drug, SensitiveDrugs, IsRow, Date, Month, Year) AS ( ",
          " SELECT  ",
          "    A.RequestID ",
          "  , A.OBRSetID ",
          "  , OBXSetID ",
          "  , OBXSubID ",
          "  , ORGANISM ",
          "  , CAST(LEFT(SensitiveDrugs, CHARINDEX('~',SensitiveDrugs+'~')-1) AS VARCHAR(250)) ",
          "  , CAST(STUFF(SensitiveDrugs, 1, CHARINDEX('~',SensitiveDrugs+'~'), '') AS VARCHAR(250)) ",
          "  , 1 ",

          "   ,(CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(day,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(day,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(day,[AuthorisedDateTime])",
          "         ELSE 0 END) as \"Date\"",
          "   ,(CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(month,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(month,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(month,[AuthorisedDateTime])",
          "         ELSE 0 END) as \"Month\"",
          "   ,(CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(year,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(year,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(year,[AuthorisedDateTime])",
          "         ELSE 0 END) as \"Year\"",

          " FROM [OpenLDRData].[dbo].[Monitoring] A ",
          " JOIN [OpenLDRData].[dbo].[Requests] B ",
          " ON A.RequestID = B.RequestID  ",
          " AND A.OBRSetID = B.OBRSetID ",
          " WHERE SurveillanceCode LIKE '{2}' ",
          "AND",
          " (",
          "  ([RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}') OR",
          "  ([AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}') OR",
          "  ([AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}')",
          "  )",
          " AND (CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(day,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(day,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(day,[AuthorisedDateTime])",
          "         ELSE 0 END) <> 0",
          " AND (CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(month,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(month,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(month,[AuthorisedDateTime])",
          "         ELSE 0 END) <> 0",
          " AND (CASE WHEN [RegisteredDateTime] >= '{0}' AND [RegisteredDateTime] < '{1}' THEN DATEPART(year,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= '{0}' AND [AnalysisDateTime]   < '{1}' THEN DATEPART(year,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= '{0}' AND [AuthorisedDateTime] < '{1}' THEN DATEPART(year,[AuthorisedDateTime])",
          "         ELSE 0 END) <> 0 ",
          " UNION ALL ",
          " SELECT  ",
          "    RequestID ",
          "  , OBRSetID ",
          "  , OBXSetID ",
          "  , OBXSubID ",
          "  , ORGANISM ",
          "  , CAST(LEFT(SensitiveDrugs, CHARINDEX('~',SensitiveDrugs+'~')-1) AS VARCHAR(250)) ",
          "  , CAST(STUFF(SensitiveDrugs, 1, CHARINDEX('~',SensitiveDrugs+'~'), '') AS VARCHAR(250)) ",
          "  , 0 ",
          "  , Date ",
          "  , Month ",
          "  , Year ",
          " FROM [Sensitive] ",
          " WHERE SensitiveDrugs > '' ",
          "), ",
          "[ClassInList](Class, ClassParam) ",
          "AS ",
          "( ",
          " SELECT  ",
          "  CAST(LEFT('{3}', CHARINDEX('~','{3}'+'~')-1) AS VARCHAR(250)) ",
          "  ,CAST(STUFF('{3}', 1, CHARINDEX('~','{3}'+'~'), '') AS VARCHAR(250)) ",
          " UNION ALL ",
          " SELECT  ",
          "  CAST(LEFT(ClassParam, CHARINDEX('~',ClassParam+'~')-1) AS VARCHAR(250)) ",
          "  , CAST(STUFF(ClassParam, 1, CHARINDEX('~',ClassParam+'~'), '') AS VARCHAR(250)) ",
          " FROM [ClassInList] ",
          " WHERE ClassParam > '' ",
          "), ",
          "[OrganismNotInList](ORGANISM, ORGANISMParam) AS ( ",
          " SELECT  ",
          "  CAST(LEFT('{4}', CHARINDEX('~','{4}'+'~')-1) AS VARCHAR(250)) ",
          "  , CAST(STUFF('{4}', 1, CHARINDEX('~','{4}'+'~'), '') AS VARCHAR(250)) ",
          " UNION ALL ",
          " SELECT  ",
          "  CAST(LEFT(ORGANISMParam, CHARINDEX('~',ORGANISMParam+'~')-1) AS VARCHAR(250)) ",
          "  , CAST(STUFF(ORGANISMParam, 1, CHARINDEX('~',ORGANISMParam+'~'), '') AS VARCHAR(250)) ",
          " FROM [OrganismNotInList] ",
          " WHERE ORGANISMParam > '' ",
          "), ",
          "[DrugNotInList](Drug, DrugParam) ",
          "AS ",
          "( ",
          " SELECT  ",
          "  CAST(LEFT('{5}', CHARINDEX('~','{5}'+'~')-1) AS VARCHAR(250)) ",
          "  , CAST(STUFF('{5}', 1, CHARINDEX('~','{5}'+'~'), '') AS VARCHAR(250)) ",
          " UNION ALL ",
          " SELECT  ",
          "  CAST(LEFT(DrugParam, CHARINDEX('~',DrugParam+'~')-1) AS VARCHAR(250)) ",
          "  , CAST(STUFF(DrugParam, 1, CHARINDEX('~',DrugParam+'~'), '') AS VARCHAR(250)) ",
          " FROM [DrugNotInList] ",
          " WHERE DrugParam > '' ",
          "), ",
          "[Totals](ORGANISM, Drug, ResultCount) AS ( ",
          " SELECT  ",
          "  ORGANISM ",
          "  , Drug ",
          "  , COUNT(*) AS ResultCount  ",
          " FROM ( SELECT  ",
          "    RequestID ",
          "    , OBRSetID ",
          "    , OBXSetID ",
          "    , OBXSubID ",
          "    , ORGANISM ",
          "    , Drug ",
          "    , 'Resistant' AS Class ",
          "    , IsRow  ",
          "   FROM Resistant  ",
          "   WHERE NULLIF(Drug, '') IS NOT NULL  ",
          "    AND ORGANISM NOT IN (SELECT ORGANISM FROM OrganismNotInList)  ",
          "    AND Drug NOT IN (SELECT Drug FROM DrugNotInList)  ",
          "   UNION ALL  ",
          "   SELECT  ",
          "    RequestID ",
          "    , OBRSetID ",
          "    , OBXSetID ",
          "    , OBXSubID ",
          "    , ORGANISM ",
          "    , Drug ",
          "    , 'Intermediate' AS Class ",
          "    , IsRow  ",
          "   FROM [Intermediate]  ",
          "   WHERE NULLIF(Drug, '') IS NOT NULL  ",
          "    AND ORGANISM NOT IN (SELECT ORGANISM FROM OrganismNotInList)  ",
          "    AND Drug NOT IN (SELECT Drug FROM DrugNotInList)  ",
          "   UNION ALL  ",
          "   SELECT  ",
          "    RequestID ",
          "    , OBRSetID ",
          "    , OBXSetID ",
          "    , OBXSubID ",
          "    , ORGANISM ",
          "    , Drug ",
          "    , 'Sensitive' AS Class ",
          "    , IsRow  ",
          "   FROM [Sensitive]  ",
          "   WHERE NULLIF(Drug, '') IS NOT NULL  ",
          "   AND ORGANISM NOT IN (SELECT ORGANISM FROM OrganismNotInList)  ",
          "   AND Drug NOT IN (SELECT Drug FROM DrugNotInList) ",
          "  ) A ",
          " GROUP BY ORGANISM, Drug ",
          "),  ",
          "[Results](ORGANISM, Drug, Class, ResultCount, Date, Month, Year) AS (  ",
          " SELECT  ",
          "  ORGANISM ",
          "  , Drug ",
          "  , Class ",
          "  , COUNT(*) AS ResultCount  ",
          "  , Date ",
          "  , Month ",
          "  , Year ",
          " FROM ( SELECT  ",
          "    RequestID ",
          "    , OBRSetID ",
          "    , OBXSetID ",
          "    , OBXSubID ",
          "    , ORGANISM ",
          "    , Drug ",
          "    , 'Resistant' AS Class ",
          "    , IsRow  ",
          "    , Date ",
          "    , Month ",
          "    , Year ",
          "   FROM Resistant ",
          "   WHERE NULLIF(Drug, '') IS NOT NULL  ",
          "    AND ORGANISM NOT IN (SELECT ORGANISM FROM OrganismNotInList)  ",
          "    AND Drug NOT IN (SELECT Drug FROM DrugNotInList)  ",
          "   UNION ALL  ",
          "   SELECT  ",
          "    RequestID ",
          "    , OBRSetID ",
          "    , OBXSetID ",
          "    , OBXSubID ",
          "    , ORGANISM ",
          "    , Drug ",
          "    , 'Intermediate' AS Class ",
          "    , IsRow  ",
          "    , Date ",
          "    , Month ",
          "    , Year ",
          "   FROM [Intermediate]  ",
          "   WHERE NULLIF(Drug, '') IS NOT NULL  ",
          "    AND ORGANISM NOT IN (SELECT ORGANISM FROM OrganismNotInList)  ",
          "    AND Drug NOT IN (SELECT Drug FROM DrugNotInList)  ",
          "   UNION ALL  ",
          "   SELECT  ",
          "    RequestID ",
          "    , OBRSetID ",
          "    , OBXSetID ",
          "    , OBXSubID ",
          "    , ORGANISM ",
          "    , Drug ",
          "    , 'Sensitive' AS Class ",
          "    , IsRow  ",
          "    , Date ",
          "    , Month ",
          "    , Year ",
          "   FROM [Sensitive]  ",
          "   WHERE NULLIF(Drug, '') IS NOT NULL  ",
          "   AND ORGANISM NOT IN (SELECT ORGANISM FROM OrganismNotInList)  ",
          "   AND Drug NOT IN (SELECT Drug FROM DrugNotInList) ",
          "  ) A ",
          " GROUP BY ORGANISM, Drug, Class, Date, Month, Year ",
          ") ",
          "SELECT  ",
          " A.ORGANISM  as [Organism] ",
          " , A.Drug ",
          " , A.Class ",
          " , A.Date ",
          " , A.Month ",
          " , A.Year ",
          " , B.ResultCount AS TotalCount ",
          " , A.ResultCount ",
          //" , CAST(A.ResultCount AS Decimal(30,6))/CAST(B.ResultCount AS DECIMAL(30,6)) AS Ratio  ",
          "FROM Results A  ",
          "LEFT OUTER JOIN Totals B  ",
          "ON A.ORGANISM = B.ORGANISM  ",
          "AND A.Drug = B.Drug  ",
          "WHERE A.Class IN (SELECT Class FROM ClassInList) "
        ]
      },
      {
        "Key": "general_GetTransmission",
        "Query": [
          "SELECT",
          " (CASE WHEN @ExcludeTests = 1 THEN 'Other' ELSE [LIMSPanelCode] END) as \"Test\"",
          " ",
          " ,(CASE WHEN LEFT([RequestID],6) = 'TZDISA'    THEN 'Disa*Lab'",
          "    WHEN LEFT([RequestID],6) = 'TZNACP'    THEN 'EVLIMS'",
          "    WHEN LEFT([RequestID],9) = 'TZLABMATE' THEN 'LabMate'",
          "    WHEN LEFT([RequestID],6) = 'TZSKYL'    THEN 'SkyLIMS'",
          "    WHEN LEFT([RequestID],5) = 'TZSTS'     THEN 'eSRS'",
          "    ELSE 'Unknown' END) as \"System\"",
          "",
          " ,(CASE WHEN RIGHT(LEFT([RequestID],9),3) IN ('TZA','TZC','TZH')         THEN 'Mnazi Mmoja'",
          "     WHEN RIGHT(LEFT([RequestID],9),3) IN ('TDS','TEQ')          THEN 'NHL-QATC'",
          "     WHEN RIGHT(LEFT([RequestID],9),3) IN ('TMS','TMC','TMH')         THEN 'Kilimanjaro Christian Medical Centre'",
          "     WHEN RIGHT(LEFT([RequestID],9),3) IN ('TBA','TBC','TBG')         THEN 'Bugando Medical Centre'",
          "     WHEN RIGHT(LEFT([RequestID],9),3) IN ('TMA','TMB','TMG')         THEN 'Mbeya Zonal Referral Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-IRI' OR [RequestID] = 'iringarrh'     THEN 'Iringa Referral Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-MTR' OR [RequestID] = 'ligularrh'     THEN 'Ligula Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-DOD' OR [RequestID] = 'dodoma'      THEN 'Dodoma Regional Referral Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-SNG'             THEN 'Singida Region Referral'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-TBR'             THEN 'Kitete Regional Referral Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-STF'             THEN 'St. Francis Designated District Hospital'",
          "     WHEN LEFT([RequestID],10) IN ('TZNACP-STE','TZNACP-STS')         THEN 'Iringa Dream Molecular Laboratory'",
          "     WHEN LEFT([RequestID],10) IN ('TZNACP-MTM', 'TZNACP-MMT') OR [RequestID] = 'mtmerurrh' THEN 'Mt. Meru'",
          "     WHEN LEFT([RequestID],10) IN ('TZNACP-MOR', 'TZNACP-MRO') OR [RequestID] = 'morogoro' THEN 'Morogoro Regional Referral Hospital'",
          "     WHEN LEFT([RequestID],9)  = 'TZLABMATE'             THEN 'MDH - Temeke'",
          "     WHEN LEFT([RequestID],11) = 'TZSKYLNDAND'            THEN 'Ndanda Regional Referral Hospital'",
          "     ELSE 'Unknown : '+[RequestID] END) as \"TestingLab\"",
          "   ,(CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN DATEPART(day,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN DATEPART(day,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN DATEPART(day,[AuthorisedDateTime])",
          "         ELSE 0 END) as \"Date\"",
          "   ,(CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN DATEPART(month,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN DATEPART(month,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN DATEPART(month,[AuthorisedDateTime])",
          "         ELSE 0 END) as \"Month\"",
          "   ,(CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN DATEPART(year,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN DATEPART(year,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN DATEPART(year,[AuthorisedDateTime])",
          "         ELSE 0 END) as \"Year\"",
          " ,SUM(CASE WHEN [ReceivedDateTime]   >= @StartDate AND [ReceivedDateTime]   < @EndDate THEN 1 ELSE 0 END) as \"Received\"",
          " ,SUM(CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN 1 ELSE 0 END) as \"Registered\"",
          " ,SUM(CASE WHEN [AnalysisDateTime]   >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN 1 ELSE 0 END) as \"Tested\"",
          " ,SUM(CASE WHEN [AuthorisedDateTime] >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN 1 ELSE 0 END) as \"Authorised\"",
          " ,SUM(CASE WHEN [LIMSRejectionCode] IS NOT NULL AND [LIMSRejectionCode] <> '' THEN 1 ELSE 0 END) as \"Rejected\"  ",
          "",
          " ,SUM(CASE WHEN ([AnalysisDateTime]   >= @StartDate AND [AnalysisDateTime]   < @EndDate) AND",
          "    ([RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate)",
          "    THEN 1 ELSE 0 END) as \"Tested_Workload\"",
          "",
          " ,SUM(CASE WHEN ([AnalysisDateTime]   >= @StartDate AND [AnalysisDateTime]   < @EndDate) AND",
          "    ([RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate) AND",
          "    ([AuthorisedDateTime] >= @StartDate AND [AuthorisedDateTime] < @EndDate)",
          "    THEN 1 ELSE 0 END) as \"Authorised_Workload\"",
          "",
          "FROM [OpenLDRData].[dbo].[Requests]",
          "WHERE",
          " (",
          "  ([RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate) OR",
          "  ([AnalysisDateTime]   >= @StartDate AND [AnalysisDateTime]   < @EndDate) OR",
          "  ([AuthorisedDateTime] >= @StartDate AND [AuthorisedDateTime] < @EndDate)",
          "  )",
          " AND (CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN DATEPART(day,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN DATEPART(day,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN DATEPART(day,[AuthorisedDateTime])",
          "         ELSE 0 END) <> 0",
          " AND (CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN DATEPART(month,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN DATEPART(month,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN DATEPART(month,[AuthorisedDateTime])",
          "         ELSE 0 END) <> 0",
          " AND (CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN DATEPART(year,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN DATEPART(year,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN DATEPART(year,[AuthorisedDateTime])",
          "         ELSE 0 END) <> 0  ",
          " AND LEFT([RequestID],5) <> 'TZSTS'",
          " AND LEFT([RequestID],5) <> 'TZHUB'",
          " AND LEFT([RequestID],5) <> 'TZMNH'",
          " AND LEFT([RequestID],7) <> 'TZTILLE'",
          " AND (CASE WHEN @ExcludeTests = 0 AND [LIMSPanelCode] IN ('HIVVL' ,'HIVPC' ,'EID') THEN 1",
          "     WHEN @ExcludeTests = 1 AND [LIMSPanelCode] NOT IN ('HIVVL' ,'HIVPC' ,'EID') THEN 1",
          "     ELSE 0 END) = 1",
          "GROUP BY",
          "   (CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN DATEPART(year,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]   >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN DATEPART(year,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime] >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN DATEPART(year,[AuthorisedDateTime])",
          "         ELSE 0 END)",
          "   ,(CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN DATEPART(month,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]    >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN DATEPART(month,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime]  >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN DATEPART(month,[AuthorisedDateTime])",
          "         ELSE 0 END)",
          "   ,(CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN DATEPART(day,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]    >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN DATEPART(day,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime]  >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN DATEPART(day,[AuthorisedDateTime])",
          "         ELSE 0 END)",
          " ,(CASE WHEN LEFT([RequestID],6) = 'TZDISA' THEN 'Disa*Lab'",
          "      WHEN LEFT([RequestID],6) = 'TZNACP' THEN 'EVLIMS'",
          "   WHEN LEFT([RequestID],9) = 'TZLABMATE' THEN 'LabMate'",
          "   WHEN LEFT([RequestID],6) = 'TZSKYL' THEN 'SkyLIMS'",
          "   WHEN LEFT([RequestID],5) = 'TZSTS' THEN 'eSRS'",
          "      ELSE 'Unknown' END),",
          "   (CASE WHEN RIGHT(LEFT([RequestID],9),3) IN ('TZA','TZC','TZH')        THEN 'Mnazi Mmoja'",
          "     WHEN RIGHT(LEFT([RequestID],9),3) IN ('TDS','TEQ')          THEN 'NHL-QATC'",
          "     WHEN RIGHT(LEFT([RequestID],9),3) IN ('TMS','TMC','TMH')         THEN 'Kilimanjaro Christian Medical Centre'",
          "     WHEN RIGHT(LEFT([RequestID],9),3) IN ('TBA','TBC','TBG')         THEN 'Bugando Medical Centre'",
          "     WHEN RIGHT(LEFT([RequestID],9),3) IN ('TMA','TMB','TMG')         THEN 'Mbeya Zonal Referral Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-IRI' OR [RequestID] = 'iringarrh'     THEN 'Iringa Referral Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-MTR' OR [RequestID] = 'ligularrh'     THEN 'Ligula Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-DOD' OR [RequestID] = 'dodoma'      THEN 'Dodoma Regional Referral Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-SNG'             THEN 'Singida Region Referral'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-TBR'             THEN 'Kitete Regional Referral Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-STF'             THEN 'St. Francis Designated District Hospital'",
          "     WHEN LEFT([RequestID],10) IN ('TZNACP-STE','TZNACP-STS')         THEN 'Iringa Dream Molecular Laboratory'",
          "     WHEN LEFT([RequestID],10) IN ('TZNACP-MTM', 'TZNACP-MMT') OR [RequestID] = 'mtmerurrh' THEN 'Mt. Meru'",
          "     WHEN LEFT([RequestID],10) IN ('TZNACP-MOR', 'TZNACP-MRO') OR [RequestID] = 'morogoro' THEN 'Morogoro Regional Referral Hospital'",
          "     WHEN LEFT([RequestID],9)  = 'TZLABMATE'             THEN 'MDH - Temeke'",
          "     WHEN LEFT([RequestID],11) = 'TZSKYLNDAND'            THEN 'Ndanda Regional Referral Hospital'",
          "     ELSE 'Unknown : '+[RequestID] END)",
          " ,(CASE WHEN @ExcludeTests = 1 THEN 'Other' ELSE [LIMSPanelCode] END)",
          "ORDER BY",
          " (CASE WHEN @ExcludeTests = 1 THEN 'Other' ELSE [LIMSPanelCode] END)",
          "   ,(CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN DATEPART(year,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]    >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN DATEPART(year,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime]  >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN DATEPART(year,[AuthorisedDateTime])",
          "         ELSE 0 END)",
          "   ,(CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN DATEPART(month,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]    >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN DATEPART(month,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime]  >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN DATEPART(month,[AuthorisedDateTime])",
          "         ELSE 0 END)",
          "   ,(CASE WHEN [RegisteredDateTime] >= @StartDate AND [RegisteredDateTime] < @EndDate THEN DATEPART(day,[RegisteredDateTime])",
          "         WHEN [AnalysisDateTime]    >= @StartDate AND [AnalysisDateTime]   < @EndDate THEN DATEPART(day,[AnalysisDateTime])",
          "         WHEN [AuthorisedDateTime]  >= @StartDate AND [AuthorisedDateTime] < @EndDate THEN DATEPART(day,[AuthorisedDateTime])",
          "         ELSE 0 END)",
          " ,(CASE WHEN LEFT([RequestID],6) = 'TZDISA' THEN 'Disa*Lab'",
          "      WHEN LEFT([RequestID],6) = 'TZNACP' THEN 'EVLIMS'",
          "   WHEN LEFT([RequestID],9) = 'TZLABMATE' THEN 'LabMate'",
          "   WHEN LEFT([RequestID],6) = 'TZSKYL' THEN 'SkyLIMS'",
          "   WHEN LEFT([RequestID],5) = 'TZSTS' THEN 'eSRS'",
          "      ELSE 'Unknown' END),",
          "   (CASE WHEN RIGHT(LEFT([RequestID],9),3) IN ('TZA','TZC','TZH')        THEN 'Mnazi Mmoja'",
          "     WHEN RIGHT(LEFT([RequestID],9),3) IN ('TDS','TEQ')          THEN 'NHL-QATC'",
          "     WHEN RIGHT(LEFT([RequestID],9),3) IN ('TMS','TMC','TMH')         THEN 'Kilimanjaro Christian Medical Centre'",
          "     WHEN RIGHT(LEFT([RequestID],9),3) IN ('TBA','TBC','TBG')         THEN 'Bugando Medical Centre'",
          "     WHEN RIGHT(LEFT([RequestID],9),3) IN ('TMA','TMB','TMG')         THEN 'Mbeya Zonal Referral Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-IRI' OR [RequestID] = 'iringarrh'     THEN 'Iringa Referral Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-MTR' OR [RequestID] = 'ligularrh'     THEN 'Ligula Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-DOD' OR [RequestID] = 'dodoma'      THEN 'Dodoma Regional Referral Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-SNG'             THEN 'Singida Region Referral'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-TBR'             THEN 'Kitete Regional Referral Hospital'",
          "     WHEN LEFT([RequestID],10) = 'TZNACP-STF'             THEN 'St. Francis Designated District Hospital'",
          "     WHEN LEFT([RequestID],10) IN ('TZNACP-STE','TZNACP-STS')         THEN 'Iringa Dream Molecular Laboratory'",
          "     WHEN LEFT([RequestID],10) IN ('TZNACP-MTM', 'TZNACP-MMT') OR [RequestID] = 'mtmerurrh' THEN 'Mt. Meru'",
          "     WHEN LEFT([RequestID],10) IN ('TZNACP-MOR', 'TZNACP-MRO') OR [RequestID] = 'morogoro' THEN 'Morogoro Regional Referral Hospital'",
          "     WHEN LEFT([RequestID],9)  = 'TZLABMATE'             THEN 'MDH - Temeke'",
          "     WHEN LEFT([RequestID],11) = 'TZSKYLNDAND'            THEN 'Ndanda Regional Referral Hospital'",
          "     ELSE 'Unknown : '+[RequestID] END)"
        ]
      },
      {
        "key": "general_getHIVVLByGeography",
        "Query": [
          "Exec dbo.sp_dash_getHIVVL_V2 @Province, @District, @Facility, @StDate, @Edate"
        ]
      },
      {
        "key": "general_getEIDByGeography",
        "Query": [
          "EXEC dbo.sp_dash_getEID_V2 @Province, @District, @Facility, @StDate, @Edate"
        ]
      },
      {
        "key": "general_GetOrgLevel",
        "Query": [
          "EXEC dbo.sp_dash_GeoLevels"
        ]
      }
    ]
  }
}
